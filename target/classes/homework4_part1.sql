CREATE SCHEMA cinema;

CREATE TABLE if not exists cinema.movies
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(150) UNIQUE NOT NULL,
    director VARCHAR(50) NOT NULL,
    year INTEGER NOT NULL,
    length_min INTEGER NOT null
);

insert into cinema.movies (title, director, year, length_min)
values
	('Sunrise', 'Eric Jonson', 2000, 134),
	('Red Stone', 'Emi Lous', 1998, 121),
	('Golden Gate', 'Robert Adyson', 2005, 145),
	('Back', 'Ron Kingsly', 2004, 123),
	('Robot', 'Eric Jonson', 2006, 133),
	('Dreams', 'Emi Lous', 2007, 113),
	('XXX', 'Ron Kingsly', 1995, 125);

insert into cinema.movies (title, director, year, length_min)
values ('Window', 'Erl Huston', 2010, 111),
	('Trip', 'Robert Adyson', 2020, 106);

CREATE TABLE IF NOT exists cinema.box_office
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    movie_id INTEGER REFERENCES cinema.movies(id),
    rating Decimal(3,2),
    domestic_sale BIGINT,
    international_sale BIGINT
);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	7.25,
	20456123,
	20587612
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	8.30,
	13298654,
	15398701
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	7.49,
	16739873,
	19876453
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	8.15,
	30076531,
	32000972
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	6.70,
	19876543,
	23009876
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	6.98,
	12345643,
	13249870
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	6.50,
	10087452,
	17084753
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	8.80,
	45739271,
	55598375
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

insert into cinema.box_office(movie_id, rating, domestic_sale, international_sale)
select
	id,
	8.12,
	30986283,
	32987563
	from cinema.movies
	WHERE id IN (SELECT id FROM cinema.movies ORDER BY random() LIMIT 1);

DELETE FROM cinema.box_office
WHERE id IN (SELECT id FROM cinema.movies ORDER BY id DESC LIMIT 9);

INSERT INTO cinema.box_office(movie_id, rating, domestic_sale, international_sale)
VALUES
   	(1, 7.25, 20456123, 20587612),
   	(2, 8.30, 13298654, 15398701),
   	(3, 7.49, 16739873, 19876453),
   	(4, 8.15, 30076531, 32000972),
   	(5, 6.70, 19876543, 23009876),
   	(6, 6.98, 12345643, 13249870),
   	(7, 6.50, 10087452, 17084753),
   	(8, 8.80, 45739271, 55598375),
   	(9, 8.12, 30986283, 32987563);

insert into cinema.movies (title, director, year, length_min)
values ('Port', 'Andrew Wips', 2022, 115);

INSERT INTO cinema.box_office(movie_id, rating, domestic_sale, international_sale)
VALUES
   	(10, 7.00, 14568030, 12097633);